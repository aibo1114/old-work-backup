// Generated by CoffeeScript 1.12.7
(function() {
  var appUser;

  W.wt = require('../func/wechat');

  appUser = require('./user');

  if (location.search.indexOf('rwt=true') > -1) {
    location.href = "http://" + cf.community.url + "/r/wt/login?" + location.search;
  }

  module.exports = appUser.extend({
    logoutByWoid: function() {
      return $.post(util.actUrl(cf.auth || "auth", "logoutByWoid"), {
        uid: user.id
      }, function() {
        user.removeData();
        if (typeof user.afterLogout === "function") {
          user.afterLogout();
        }
        return user.clear();
      });
    },
    loginByWoid: function(wCode, woid, cb) {
      if (wCode == null) {
        wCode = util.getCookie('wCode');
      }
      if (woid == null) {
        woid = util.getCookie('woid');
      }
      log('login by woid');
      if (!wCode || !woid) {
        popMsg('微信登录已过期, 请重新连接登录', 'warning');
        return;
      }
      return $.ajax({
        type: 'post',
        url: util.actUrl('auth', 'loginByWoid'),
        data: {
          woid: woid,
          wCode: wCode,
          lang: cf.lang
        },
        success: function(res) {
          popMsg('wechat login success');
          user.login(res.user);
          if (typeof cb === "function") {
            cb();
          }
        },
        error: function() {
          log('no loginin ...');
          if (util.getCookie('wtbase')) {
            user.id = util.getCookie('woid');
            user.username = '匿名';
            return user.fake = true;
          } else {
            return typeof user.afterLogout === "function" ? user.afterLogout() : void 0;
          }
        }
      });
    }
  });

}).call(this);

//# sourceMappingURL=wechatUser.js.map
