// Generated by CoffeeScript 1.12.7
(function() {
  var _userBox, entity, tag;

  tag = require('../view/tag');

  entity = require('../model/entity');

  _userBox = cf.view.collection.extend({
    toFetch: true,
    entity: 'user',
    criteriaOpt: {
      score: 'eq_l_6',
      _attrs: 'username,refFile,score'
    },
    addAll: function() {
      var d, i, len, n, p, ref, results, w;
      w = screen.width / 15;
      ref = this.data;
      results = [];
      for (i = 0, len = ref.length; i < len; i++) {
        d = ref[i];
        util.pStr(d, 'refFile');
        n = d.username;
        if (d.score > 6) {
          n += "(" + d.score + ")";
        }
        p = util.resPath("portrait-" + d.id + ".jpg");
        results.push(this.ctn.append("<div class='lotImg'><img id='p-" + d.id + "' width='" + w + "' height='" + w + "' src='" + p + "'/><p>" + n + "</p></div>"));
      }
      return results;
    }
  });

  module.exports = tag.extend({
    init: function() {
      return this.render();
    },
    events: {
      'click .start': function(e) {
        var t;
        t = util.ct(e);
        this.num = 0;
        t.hide();
        t.next().show();
        this.renderUsers();
        return this.renderBox();
      },
      'click .lotBtn': function(e) {
        var cl, i, it, n, ok, opt, ref, results, score, t, tg;
        score = 6 + this.lCount;
        ok = this.$('.wins');
        cl = 'turn';
        t = this.$('.lotUser img').length;
        results = [];
        for (it = i = 0, ref = this.lCount - 1; 0 <= ref ? i <= ref : i >= ref; it = 0 <= ref ? ++i : --i) {
          n = Math.ceil(Math.random() * t);
          tg = this.$('.lotUser img').eq(n - 1);
          ok.append(tg);
          opt = {
            id: tg.attr('id').split('-')[1],
            score: score,
            auth: true,
            _attrs: 'score'
          };
          new _entity(opt, {
            entity: 'user'
          }).save();
          results.push(t--);
        }
        return results;
      },
      'click .pre': function(e) {
        if (this.num > 0) {
          this.num--;
          return this.renderBox();
        }
      },
      'click .next': function(e) {
        if (this.num < (this.pData.length - 1)) {
          this.num++;
          return this.renderBox();
        }
      },
      'click .wed img': function(e) {
        var opt;
        opt = {
          id: util.getTargetId(e),
          score: 6,
          auth: true,
          _attrs: 'score'
        };
        return new entity(opt, {
          entity: 'user'
        }).save();
      }
    },
    pickIt: function() {},
    renderBox: function() {
      this.$('h2').text(this.pData[this.num].title);
      return this.lCount = this.pData[this.num].num;
    },
    renderUsers: function() {
      new _userBox({
        cleanAll: false,
        criteriaOpt: {
          score: 'gt_l_6',
          _attrs: 'username,refFile,score',
          max: -1
        },
        parent: $('.wed'),
        addAll: function() {
          var d, i, len, n, p, ref, results, w;
          w = screen.width / 15;
          ref = this.data;
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            d = ref[i];
            util.pStr(d, 'refFile');
            n = d.username;
            p = util.resPath("portrait-" + d.id + ".jpg");
            results.push($('.we' + (d.score - 6)).append("<div class='lotImg'><img id='p-" + d.id + "' width='" + w + "' height='" + w + "' src='" + p + "'/><p>" + n + "</p></div>"));
          }
          return results;
        }
      });
      return new _userBox({
        cleanAll: false,
        pp: this,
        criteriaOpt: {
          score: 'eq_l_6',
          _attrs: 'username,refFile,score',
          max: -1
        },
        parent: $('.lotUser')
      });
    }
  });

}).call(this);

//# sourceMappingURL=lottery.js.map
