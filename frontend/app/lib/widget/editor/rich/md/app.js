// Generated by CoffeeScript 1.12.7
(function() {
  var initEditor, insertImg, md;

  insertImg = require('../insertImg');

  initEditor = function(ps) {
    var clen, opt, p, t;
    p = $(ps.parent);
    t = p.find('textarea');
    ps.form.model.set('cType', 'md');
    opt = {
      language: _lang,
      additionalButtons: [
        [
          {
            name: 'groupCustom',
            data: [
              {
                name: 'uploadPic',
                toggle: true,
                title: 'Upload Pic',
                icon: _st.icon('picture'),
                callback: function(e) {
                  var content, selected;
                  selected = e.getSelection();
                  content = e.getContent();
                  return insertImg(function(chunk) {
                    var cursor;
                    e.replaceSelection(chunk);
                    cursor = selected.start;
                    return e.setSelection(cursor, cursor + chunk.length);
                  });
                }
              }, {
                name: 'pickRef',
                toggle: true,
                title: 'Pick Ref',
                icon: _st.icon('th'),
                callback: function(e) {
                  return log(22);
                }
              }
            ]
          }
        ]
      ]
    };
    opt.footer = '';
    if (ps.liveShow) {
      opt.footer += '<div id="twitter-footer" class="well" style="display:none;"></div>';
      opt.hiddenButtons = 'cmdPreview';
    }
    if (ps.size) {
      clen = 0;
      if (ps.val) {
        clen = ps.val.length;
      }
      opt.footer += "<small id='twitter-counter' class='text-success'>" + (ps.size - clen) + " character left</small>";
      opt.onChange = function(e) {
        var content, content_length, size;
        size = ps.size;
        content = e.parseContent();
        content_length = (content.match(/\n/g) || []).length + content.length;
        if (content === '') {
          $('#twitter-footer').hide();
        } else {
          $('#twitter-footer').show().html(content);
        }
        if (content_length > 140) {
          return $('#twitter-counter').removeClass('text-success').addClass('text-danger').html(content_length - size + ' character surplus.');
        } else {
          return $('#twitter-counter').removeClass('text-danger').addClass('text-success').html(size - content_length + ' character left.');
        }
      };
    }
    return t.markdown(opt);
  };

  md = cf.view.markdown = {
    fun: function(opt) {
      util.lcss(cf.rPath + "js/bootstrap-markdown/css/bootstrap-markdown.min.css");
      return cf.loadJS(cf.rPath + 'js/bootstrap-markdown/js/bootstrap-markdown.js', function() {
        return cf.loadJS(cf.rPath + 'js/marked/lib/marked.js', function() {
          if (_lang === 'zh') {
            return cf.loadJS(cf.rPath + ("js/bootstrap-markdown/locale/bootstrap-markdown." + _lang + ".js"), function() {
              return initEditor(opt);
            });
          } else {
            return initEditor(opt);
          }
        });
      });
    }
  };

  m._markdown = function(code, opt) {
    return $.extend(true, {
      code: code,
      type: 'textarea',
      xtype: 'markdown',
      attrs: {
        rows: 12
      }
    }, opt);
  };

  module.exports = md;

}).call(this);

//# sourceMappingURL=app.js.map
