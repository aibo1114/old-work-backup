// Generated by CoffeeScript 1.12.7
(function() {
  var editor;

  editor = function(opt) {
    var date, fmt, o, p, v;
    if (opt.dMode) {
      return;
    }
    p = $(opt.parent);
    p.parent().addClass('has-feedback');
    date = p.find('input');
    date.addClass('_datetime');
    fmt = opt.fmt || "yyyy-mm-dd hh:ii:ss";
    o = {
      showMeridian: true,
      autoclose: true,
      todayBtn: true,
      language: opt.lang || 'zh-CN',
      format: fmt
    };
    opt.val || (opt.val = date.val());
    if (_.isFunction(opt.val)) {
      opt.val = opt.val();
    }
    if (opt.val) {
      if (opt.val.length === 24) {
        opt.val = Date.parseLocal(opt.val).pattern();
      }
      date.val(opt.val);
    } else if (!opt.noVal) {
      v = opt.minView === 2 ? new Date().pattern('yyyy-MM-dd') : new Date().pattern('yyyy-MM-dd HH') + ':00:00';
      date.val(v);
    }
    date.datetimepicker($.extend(o, opt));
    return date.parent().addClass('rel').append("<span class=\"form-control-feedback " + (util.iClass('th')) + "\"></span>");
  };

  cf.view.dTime = {
    _type: 'dTime',
    fun: function(opt) {
      if ($.fn.datetimepicker) {
        return editor(opt);
      } else {
        util.lcss(cf.rPath + 'js/smalot-bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css');
        return cf.loadJS(cf.rPath + 'js/smalot-bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js', function() {
          if (_lang === 'zh') {
            opt.lang = 'zh-CN';
            return cf.loadJS(cf.rPath + 'js/smalot-bootstrap-datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js', function() {
              return editor(opt);
            });
          } else {
            return editor(opt);
          }
        });
      }
    }
  };

  $.extend(meta.common, {
    startedDate: {
      id: 'sTime',
      type: "text",
      xtype: 'dTime',
      valid: {
        earlyThan: "#eTime"
      },
      showText: function(v) {
        return v;
      },
      attrs: {
        minuteStep: 5,
        minView: 0
      }
    },
    endDate: {
      id: 'eTime',
      type: "text",
      xtype: 'dTime',
      valid: {
        laterThan: "#sTime"
      },
      showText: function(v) {
        return v;
      },
      attrs: {
        minuteStep: 5,
        minView: 0
      }
    },
    pubTime: {
      type: 'text',
      xtype: 'dTime',
      isShow: function() {
        return W.user && W.user.isAdmin();
      }
    }
  });

}).call(this);

//# sourceMappingURL=dTime.js.map
