// Generated by CoffeeScript 1.12.7
(function() {
  var tree, treeForm;

  tree = require('./tree');

  treeForm = require('./treeForm');

  module.exports = treeForm.extend({
    edit: function(e) {
      var dd;
      dd = this.findItem(util.ct(e).attr('id'));
      dd = _.clone(dd);
      dd[this.subName] = null;
      this.channelForm({
        data: dd,
        _saveSuccess: function(m) {
          var d, v;
          d = m.toJSON();
          v = m.view;
          v.p.updateItem(d);
          return v.$el.remove();
        }
      });
      return e.stopPropagation();
    },
    initData: function() {
      return {};
    },
    add: function(e) {
      var data, pe, pid, t;
      t = util.ct(e);
      pe = t.closest('ul').siblings("a[id]");
      pid = pe.length ? pe.attr('id') : this.$('.root').attr('id');
      data = this.initData(t, pid);
      data[this.parentKey] = pid;
      this.channelForm({
        data: data,
        pid: pid,
        _saveSuccess: function(m) {
          var d, v;
          d = m.toJSON();
          v = m.view;
          v.p.addItem(v.pid, d);
          return v.$el.remove();
        }
      });
      return e.stopPropagation();
    },
    afterDel: function(id) {
      var ot;
      ot = {};
      ot[cf.id] = id;
      return cf.dm.ent(ot, {
        entity: this.entity
      }).destroy({
        wait: true
      });
    }
  });

}).call(this);

//# sourceMappingURL=treeEntityForm.js.map
