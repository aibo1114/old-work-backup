// Generated by CoffeeScript 1.12.7
(function() {
  require('./meta/inquiry');

  require('./meta/answer');

  require('./meta/order');

  m.inquiry.listOpt = {
    _attrs: function() {
      return 'username,content,dateCreated';
    },
    criteriaOpt: function() {
      return {
        q: {
          phone: user.get('phone')
        }
      };
    },
    itemContext: function(d) {
      return $.extend(d, {
        title: d.username + " 【" + (d.dateCreated.dStr()) + "】",
        brief: " " + d.content
      });
    }
  };

  m.answer.listOpt = {
    _attrs: function() {
      return 'user,content,dateCreated';
    },
    criteriaOpt: function() {
      return {
        q: {
          'questioner.phone': user.get('phone')
        }
      };
    },
    itemContext: function(d) {
      return $.extend(d, {
        title: "" + d.user.username,
        subTitle: "回答时间:【" + (d.dateCreated.dStr()) + "】 ",
        brief: d.content
      });
    }
  };

  m.order.listOpt = {
    btns: [
      {
        label: '我要预约',
        href: util.navUrl('apply', 'order'),
        cls: 'btn btn-small btn-primary'
      }
    ],
    _attrs: function() {
      return 'phone,status,symptom,dateCreated,consultant,shop,appointmentTime';
    },
    criteriaOpt: function() {
      return {
        q: {
          phone: user.get('phone')
        }
      };
    },
    itemContext: function(d) {
      return $.extend(d, {
        title: "【" + (cf.st.text('order', d.status || 10)) + "】" + (d.shop ? d.shop.title : '') + " " + (d.consultant ? d.consultant.username : ''),
        subTitle: "预约时间:【" + (d.appointmentTime.dStr()) + "】",
        brief: "症状: " + d.symptom
      });
    }
  };

  app.enhance({
    routes: {
      '!/my/qa(/:type)': 'question',
      '!/my/order': 'order'
    },
    order: function() {
      return this.dm.collection(ctn, 'order', {
        title: '我的预约',
        noFilter: true,
        topBtn: true
      });
    },
    question: function(type) {
      if (type == null) {
        type = 'inquiry';
      }
      util.tabPage(ctn, [
        {
          href: tu.navUrl('my/qa', 'inquiry'),
          title: '我的咨询',
          tabClass: 'inquiry'
        }, {
          href: tu.navUrl('my/qa', 'answer'),
          tabClass: 'answer',
          title: '我的答案'
        }
      ], type, function() {
        return $('.nav-tabs').append(tu.genBtn({
          label: '我要咨询',
          href: util.navUrl('apply', 'inquiry'),
          cls: 'btn btn-small btn-primary pull-right myInz'
        }));
      });
      return this.dm.collection('.tab-content', type, {
        head: false
      });
    }
  });

}).call(this);

//# sourceMappingURL=my.js.map
