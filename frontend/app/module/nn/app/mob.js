// Generated by CoffeeScript 1.12.7
(function() {
  var alert, ctn, router;

  require('./style/mob.css');

  require('../../../lib/main');

  require('../../../lib/widget/prompt');

  require('../../../lib/func/wtShare');

  require('../../../../public/res/js/jquery.finger/dist/jquery.finger');

  cf.loadTmpl = function(name) {
    return require("./tmpl/" + name + ".jade");
  };

  cf.loadLibTmpl = function(name) {
    return require("../../../lib/tmpl/" + name + ".jade");
  };

  router = require("../../../lib/router");

  require('../../../lib/view/tag');

  require('../../../lib/view/list');

  cf.noReply = true;

  meta.item = {
    _: {}
  };

  cf.afterStart = function() {
    if (!location.hash) {
      return cf.r('index');
    }
  };

  ctn = '#content';

  alert = function(tmpl, func) {
    return app.dm.tag('air', {
      mode: null,
      className: 'rdb',
      tmpl: tmpl,
      events: {
        'click .btn': func
      }
    });
  };

  $('body').on('tap', '.imgBtn img', function(e) {
    cf.r('vote');
    e.preventDefault();
    return e.stopPropagation();
  });

  $('body').on('tap', '.modal .modal-body img', function(e) {
    var t;
    t = util.ct(e);
    t.closest('.modal-content').find('.close').trigger('click');
    e.preventDefault();
    return e.stopPropagation();
  });

  new router({
    routes: {
      '!/index': 'index',
      '!/vote': 'vote',
      '!/done': 'done',
      '!/result': 'result'
    },
    index: function() {
      cf._ssd = true;
      if (new Date().getTime() > +$('#endDate').val()) {
        cf.r('result');
        return;
      }
      this.ctn.html(cf.rtp('index'));
      return $('body').css({
        'background-color': '#594374'
      });
    },
    result: function() {
      if (!cf._ssd) {
        cf.r('index');
        return;
      }
      this.dm.collection(ctn, 'vote', {
        title: '投票结果',
        max: 100,
        style: 'panel',
        criteriaOpt: function() {
          return {
            p: {
              sort: {
                count: -1
              }
            }
          };
        },
        itemContext: function(d) {
          d.brief = d.count;
          return d;
        }
      });
      return $('body').css({
        'background-color': '#33286d'
      });
    },
    vote: function() {
      if (!cf._ssd) {
        cf.r('index');
        return;
      }
      $('body').css({
        'background-color': '#764bb0'
      });
      return this.dm.collection(ctn, 'vote', {
        max: 100,
        ma_fade: true,
        events: {
          'click .submit': function(e) {
            var chs, i, it, len, len1;
            chs = this.$('.checkbox.checked');
            if ((len = chs.length) < 3) {
              alert('rdb1', function() {
                return this.closeDlg();
              });
            } else if (util.getCookie('_voted')) {
              alert('rdb2', function() {
                this.closeDlg();
                return cf.r('result');
              });
            } else {
              for (i = 0, len1 = chs.length; i < len1; i++) {
                it = chs[i];
                $.post(util.actUrl("inc/vote/" + ($(it).attr('sid')) + "/count"));
              }
              util.setCookie('_voted', true, 1);
              cf.r('done');
            }
            return e.stopD;
          },
          'click .cover': function(e) {
            var t;
            t = util.ct(e);
            return t.next().children().trigger('click');
          },
          'click .sub': function(e) {
            var t;
            t = util.ct(e);
            return t.children().trigger('click');
          },
          'click .checkbox': function(e) {
            var chs, t;
            t = util.ct(e);
            t.toggleClass('checked');
            chs = this.$('.checkbox.checked');
            if (chs.length > 3) {
              alert('rdb1', function() {
                return this.closeDlg();
              });
              t.removeClass('checked');
            }
            e.preventDefault();
            return e.stopPropagation();
          }
        },
        mode: null,
        tmpl: 'vote',
        modelOpt: {
          className: 'col-xs-6',
          tmpl: 'voteItem'
        }
      });
    },
    done: function() {
      if (!cf._ssd) {
        cf.r('index');
        return;
      }
      this.ctn.html(cf.rtp('done'));
      $('.done').on('click', '.inBtn .btn', function() {
        return alert('rdb3', function() {
          return this.closeDlg();
        });
      });
      util.loadPic('.done');
      return $('body').css({
        'background-color': '#33286c'
      });
    }
  });

}).call(this);

//# sourceMappingURL=mob.js.map
