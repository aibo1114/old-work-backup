// Generated by CoffeeScript 1.12.7
(function() {
  var $style, form, router;

  require('../style/main.css');

  require('../../../lib/init');

  require('../../../lib/util/loadNewPic');

  router = require('../../../lib/router');

  require('../../../res/js/smalot-bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css');

  $.extend(window, {
    _lang: 'zh',
    _i: require('../i18n/zh')
  });

  cf.loadTmpl = function(name) {
    return require("../tmpl/" + name + ".jade");
  };

  cf.loadLibTmpl = function(name) {
    return require("../../../lib/tmpl/" + name + ".jade");
  };

  window._token = $('#token').val();

  cf._jsonp = true;

  cf.rPath = '/res/';

  form = require('../../../lib/view/form');

  require('./meta');

  require('../../../res/js/area_postcode.js');

  cf.jsCache.push('/res/js/area_postcode.js');

  Backbone.Model.setPost();

  if (isIE(8)) {
    $style = $('<style type="text/css">:before,:after{content:none !important}</style>');
    $('head').append($style);
    setTimeout((function() {
      return $style.remove();
    }), 0);
  }

  new router({
    routes: {
      '': 'index',
      'index': 'index',
      '!/search': 'search',
      '!/result': 'result',
      '!/lostAdditional': 'lostAdditional'
    },
    index: function() {
      return $.getJSON("http://zhaohui.liebao.cn/f/news?_token=" + _token + "&callback=?").done((function(_this) {
        return function(res) {
          var i, it, len, ref, rf;
          _this.ctn.html(cf.rtp('index'));
          rf = _this.ctn.find('.refresh');
          ref = res.data;
          for (i = 0, len = ref.length; i < len; i++) {
            it = ref[i];
            rf.append(cf.rtp('listItem', {
              title: it.name,
              alt: it.alt,
              href: it.url,
              date: it.time
            }));
          }
          return _setHeight(470);
        };
      })(this));
    },
    search: function() {
      this.ctn.html(cf.rtp('search', {
        back: location.href.split('#')[0]
      }));
      return new form({
        mode: 'blank',
        title: null,
        entity: 'question',
        saveByStep: false,
        cols: 'col-md-4:col-md-8',
        urlRoot: "http://zhaohui.liebao.cn/f/submit?_token=" + _token,
        before: function(res) {
          var it;
          if (res.payList) {
            res.payList = (function() {
              var i, len, ref, results;
              ref = res.payList;
              results = [];
              for (i = 0, len = ref.length; i < len; i++) {
                it = ref[i];
                results.push("日期：" + it.payDate + " 订单号：" + it.payNum + " 支付方式：" + it.payType + " 金额：" + it.payPrice);
              }
              return results;
            })();
          }
          res.local = "地点1：" + res.localText1 + " 地点2：" + res.localText2;
          return res;
        },
        saveSuccess: function(model, res, options) {
          if (res.ret === 1) {
            return $('.form').html(cf.rtp('done', {
              num: res.data
            }));
          } else {
            return popMsg(res.msg, 'warning');
          }
        },
        parent: '.form',
        toFetch: false
      });
    },
    lostAdditional: function() {
      cf._noId = false;
      cf._fsName = null;
      return new form({
        mode: 'blank',
        title: null,
        entity: 'question',
        spItem: 'lost',
        cols: 'col-md-4:col-md-8',
        urlRoot: "http://zhaohui.liebao.cn/f/submit1?_token=" + _token,
        callback: function() {
          this.$('.col-md-8:eq(1)').attr('class', 'col-md-4');
          this.$('.col-md-8:eq(1)').attr('class', 'col-md-4');
          cf.addMemoLink();
          $('.showId').trigger('click');
          return _setHeight(665);
        },
        validForm: function() {
          if (!cf._fsName) {
            popMsg('请上传身份证照片', 'warning');
            return false;
          }
          return true;
        },
        saveSuccess: function(model, res, options) {
          if (res.ret === 1) {
            return $('#content').html(cf.rtp('done', {
              num: res.data
            }));
          } else {
            return popMsg(res.msg, 'warning');
          }
        },
        parent: '#content',
        toFetch: false,
        btns: ['back', 'save']
      });
    },
    result: function() {
      return new form({
        mode: 'blank',
        title: '查询工单',
        entity: 'question',
        spItem: 'search',
        parent: '#content',
        cols: 'col-md-4:col-md-5',
        toFetch: false,
        setBtns: function() {
          return [
            {
              label: '返回',
              href: location.href.split('#')[0],
              cls: 'btn btn-default btn-lg'
            }, {
              label: '查询',
              cls: 'btn btn-primary btn-lg save'
            }
          ];
        },
        btns: ['back', 'save'],
        callback: function() {
          this.$('.help-block').remove();
          return _setHeight(335);
        },
        _save: function() {
          return $.getJSON("http://zhaohui.liebao.cn/f/getorder?_token=" + _token + "&tel=" + (this.model.get('tel')) + "&order=" + (this.model.get('order')) + "&vcode=" + (this.model.get('vcode')) + "&callback=?", (function(_this) {
            return function(res) {
              if (res.ret === 1) {
                _setHeight(1000);
                _this.$el.next('table').remove();
                return _this.$el.after(cf.rtp('resultItem', res.data));
              } else {
                return popMsg(res.msg, 'warning');
              }
            };
          })(this));
        }
      });
    }
  });

}).call(this);

//# sourceMappingURL=main.js.map
