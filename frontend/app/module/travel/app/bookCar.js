// Generated by CoffeeScript 1.12.7
(function() {
  var cfc;

  cfc = cf._carService = {};

  $('.travels').on('change', '.tt', function(e) {
    var cl, id, it, t, title;
    t = util.ct(e);
    id = t.closest('.travels').attr('id');
    cl = (cfc[id] != null ? cfc[id] : cfc[id] = []);
    if (t.is(':checked')) {
      it = {
        id: t.attr('id'),
        price: t.data('price'),
        from: t.data('from'),
        to: t.data('to'),
        type: t.data('type')
      };
      title = (function() {
        switch (it.type) {
          case 'pickup':
            return "Airport Pickup<br/><small>$" + it.price + " " + it.from + " to " + it.to + "</small>";
          case 'transfer':
            return "Airport Transfer<br/><small>$" + it.price + " " + it.from + " to " + it.to + "</small>";
          case 'greatWall':
            return "Great Wall Transfer<br/><small>$" + it.price + " " + it.from + " to/from " + it.to + "</small>";
        }
      })();
      it.title = title;
      return cl.push(it);
    } else {
      return cl.delBy(t.data('id'));
    }
  });

  $.extend(meta.deal._, {
    pickupTime: {
      showCvt: dateCvt
    },
    departureTime: {
      showCvt: dateCvt
    },
    landingTime: {
      showCvt: dateCvt
    }
  });

  app.enhance({
    routes: {
      '!/bookCar/:id': 'bookCar'
    },
    bookCar: function(id) {
      var cars, i, it, len, num, obj, steps, total;
      obj = window["p_" + id];
      cars = cf._carService["" + id];
      if (!cars || cars.length === 0) {
        popMsg('Please choose service option firstly', 'warning');
        app.navigate('', {
          trigger: true
        });
        return;
      }
      steps = ['Select Services', 'Pay Deposit', 'Booking Confirmation'];
      total = 0;
      for (i = 0, len = cars.length; i < len; i++) {
        it = cars[i];
        total += it.price;
      }
      num = cf.orderNum();
      return new cf.view.tabForm({
        parent: this.ctn.empty(),
        saveByStep: false,
        className: 'pay',
        entity: 'deal',
        toFetch: false,
        tmpl: 'pay',
        syncBox: '.review',
        exEvents: {
          'change .dInput>select': dInputEvent
        },
        _saveSuccess: function(model) {
          return model.view.renderNextTab();
        },
        before: function(attr) {
          var k, kk, ref, trip, v;
          trip = attr.trip;
          for (k in attr) {
            v = attr[k];
            if (k.indexOf(':') > -1) {
              ref = k.split(':'), kk = ref[0], id = ref[1];
              trip.find(id)[kk] = v;
              util.del(k, attr);
            }
          }
          return attr;
        },
        context: function() {
          return {
            steps: steps,
            title: 'Build Your Private Car Service In Beijing'
          };
        },
        data: {
          num: num,
          cat: 'car',
          status: cf.st.init('deal'),
          total: total,
          trip: cars,
          car: {
            title: obj.title,
            _id: id
          }
        },
        items: [
          {
            tmpl: 'carService',
            context: function() {
              return {
                steps: steps,
                title: obj.title,
                num: 1,
                cars: cars,
                total: total
              };
            }
          }, {
            tmpl: 'deposit',
            context: function() {
              return {
                steps: steps,
                num: 2,
                title: obj.title
              };
            },
            callback: function() {
              return this.$('.payNow').click((function(_this) {
                return function() {
                  return cf.paypalNow(_this.model.attributes);
                };
              })(this));
            }
          }, {
            tmpl: 'confirmation',
            context: function() {
              return {
                steps: steps,
                title: obj.title,
                num: 3
              };
            }
          }
        ]
      });
    }
  });

}).call(this);

//# sourceMappingURL=bookCar.js.map
